# Databank API Dockerfile
FROM python:3.11.13-slim-bookworm

# Build args for Databank repo
ARG DATABANK_URL=https://github.com/NMRLipids/FAIRMD_lipids
ARG DATABANK_BRANCH=main

# Environment variables
ENV DATABANK_PATH=/app/Databank 
  
WORKDIR /app

# Install git 
RUN apt-get update \
 && apt-get install -y --no-install-recommends git \
 && rm -rf /var/lib/apt/lists/* 

RUN git clone https://github.com/NMRLipids/BilayerData BilayerData

ENV FMDL_DATA_PATH=/app/BilayerData

WORKDIR /app
# Copy the API application
COPY src/Backend/Databank_api/. /app/
# Copy the api return standard:
COPY src/Backend/api_return_standard.py /app/api_return_standard.py

RUN pip install --no-cache-dir -r requirements.txt

# Expose internal port
EXPOSE 8000

CMD ["gunicorn", "-c", "gunicorn_config.py", "databank_api:app"]